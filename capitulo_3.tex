%IMD PNA http://na.support.keysight.com/pna/help/latest/Applications/Swept_IMD_Configure_External_Source_and_Combiner.htm
\chapter{Teoría musical}



%%-----------------------------------------------------------------------


%\section{}

La teoría musical es el estudio de los elementos que conforman la música. En esta teoría se analizan todos los sonidos involucrados para la creación, análisis y composición musical.

La música es un arte que se basa en 2 elementos: 

\begin{itemize} [noitemsep]
	\item Los sonidos
	\item Los silencios
\end{itemize}

Los sonidos tienen diferentes propiedades las cuales se describen a continuación:

\begin{itemize}
	\item \textbf{Altura.-} un sonido puede ser agudo, medio o grave, dependiendo de la altura de su nota.
	\item \textbf{Duración.-} un sonido debe de tener una duración la cual se expresa en unidades de tiempo.
	\item \textbf{Intensidad.-} esto se refiere al volumen del sonido, puede ser débil o fuerte.
	\item \textbf{Timbre.-} se le conoce como timbre o color del sonido a como un sonido con la misma nota suena diferente dependiendo del instrumento usado para su interpretación.  
\end{itemize}

Los silencios a su vez su única propiedad intrínseca es la duración, es decir en un silencio lo único que se mide es la duración del mismo.

\section{Composición musical}

La composición musical esta catalogado como un arte que tiene como objeto crear nuevas piezas musicales.

Un músico puede optar por varios caminos para la creación de su obra, existen músicos que se basan en su simple sentido común y crean canciones liricamente, sin embargo el proceso formal de composición involucra todos los conceptos musicales básicos de la teoría musical, los cuales se describirán a continuación.

\subsection{Notas musicales}

Las notas es un sistema que se usa para la representación de los diferentes sonidos en la música. En el mundo occidental se usa un sistema de 12 notas, los cuales pueden ser repetidos con diferentes alturas para generar una gama muy amplia de sonidos.
Dentro de este sistema de 12 notas tenemos las notas naturales y las notas con alteraciones.
Las notas naturales son:

Do, Re, Mi, Fa, Sol, La, Si   (7 notas)

Las alteraciones no son más que agregar o quitar medios tonos a una nota, para eso se usan los siguientes símbolos:

\begin{itemize}
	\item \textbf{\# (sostenido).-} se agrega $1/2$ tono a una nota.
	\item \textbf{x (doble sostenido).-} Se agrega 1 tono a una nota.
	\item \textbf{$\flat$ (bemol).-} se disminuye $1/2$ tono a una nota.
	\item \textbf{$\flat\flat$ (doble bemol).-} Se disminuye 1 tono a una nota.  
\end{itemize}

Usando los símbolos anteriores podemos definir las siguientes notas con alteraciones:

Do\#, Re\#, Fa\#, Sol\#, La\#  (5 notas)

Como se puede observar tanto Mi y Si no tienen sonidos con alteraciones ascendentes, ya que los sonidos producidos por estas alteraciones son igual al de las notas consecutivas, a este tipo de sonidos iguales se les conoce como notas enarmónicas.

Por ejemplo:

\begin{itemize}
	\item Mi\# sonaría exactamente igual que un Fa.
	\item Si\# sonaría exactamente igual que un Do.  
\end{itemize}

También las notas con alteraciones pueden ser representadas usando el símbolo de bemol (b), es decir restando medio tono a una nota. En este caso se tendrían las notas con alteraciones de la siguiente manera:

Re$_\flat$, Mi$_\flat$, Sol$_\flat$, La$_\flat$, Si$_\flat$      (5 notas)

Como se mencionó anteriormente las notas que en sonido son exactamente iguales pero en nomenclatura son diferentes se conocen como notas enarmónicas, de tal manera que las 5 notas con alteraciones que se describieron se pueden hacer una comparación del sonido de las mismas, siendo así se tiene:

\begin{itemize}
	\item Do\#  suena exactamente igual que Re$_\flat$.
	\item Re\# suena exactamente igual que Mi$_\flat$. 
	\item Fa\# suena exactamente igual que Sol$_\flat$. 
	\item Sol\# suena exactamente igual que La$_\flat$. 
	\item La\# suena exactamente igual que Si$_\flat$.   
\end{itemize}

Podemos ver la relación de tonos y semitonos (1/2 tonos) en la siguiente figura:

\begin{figure}[H]
	\centerline{\includegraphics[width=12cm]{tonos.png}}
	\caption{Relacion de tonos y semitonos}
	\label{fig:tonos}
\end{figure}

Como se puede observar entre Mi y Fa existe un semitono, al igual que entre Si y Do.

El pentagrama es un sistema de cinco líneas y cuatro espacios para escribir música:

\begin{figure}[H]
	\centerline{\includegraphics[width=4cm]{pentagrama.png}}
	\caption{Pentagrama}
	\label{fig:pentagrama}
\end{figure}

Este sistema puede tener diferentes elementos dentro de los principales tenemos:

\begin{itemize} [noitemsep]
	\item Clave.
	\item Compás.
	\item Armadura. 
	\item Notas.
\end{itemize}

\subsection{Claves musicales}

Las claves musicales se usan para darle nombre y altura a las notas musicales dentro de un pentagrama.

Las claves más usadas en la música son: la clave de Sol, la clave de Fa y la clave de Do.

La clave de Sol se usa en instrumentos agudos como la guitarra, violín, entre otros. Esta clave normalmente se escribe empezando en la segunda línea del pentagrama para formar una especie de G. El hecho de que esta clave se escriba en la segunda línea establece que esa línea será llamada como el nombre de la clave, en este caso Sol:

\begin{figure}[H]
	\centerline{\includegraphics[width=4cm]{clave_sol.png}}
	\caption{Clave de Sol en 2da. Linea}
	\label{fig:clave_sol}
\end{figure}

La clave de Fa es usada en instrumentos más graves, tales como el contrabajo, el bajo, etc. Normalmente se escribe empezando en la cuarta línea, de tal manera que esta línea tomara el nombre de Fa:

\begin{figure}[H]
	\centerline{\includegraphics[width=4cm]{clave_fa.png}}
	\caption{Clave de Fa en 4ta. Linea}
	\label{fig:clave_fa}
\end{figure}

La clave de Do es usada comúnmente para las voces, y esta clave se escribe en diferentes líneas dependiendo del timbre de la voz, para un tenor se usa la clave de Do en 4ta línea, mientras que para un soprano normalmente la clave se usa en 3ra o 2da línea:

\begin{figure}[H]
	\centerline{\includegraphics[width=8cm]{clave_do.png}}
	\caption{Clave de Do en 4ta. y 3ra. linea}
	\label{fig:clave_do}
\end{figure}

A partir de estas claves se le puede poner nombre a las diferentes líneas y espacios del pentagrama, por ejemplo en la clave de sol en segunda línea, el pentagrama quedaría de la siguiente forma:

\begin{figure}[H]
	\centerline{\includegraphics[width=8cm]{notas_clave_sol.png}}
	\caption{Nombre de las notas en un pentagrama con clave de Sol}
	\label{fig:notas_clave_sol}
\end{figure}

\subsection{Compases y tiempo}

El compás se puede definir como la unidad métrica de la música, es la que nos dice que tiempo llevara la canción.

Existen una infinidad de compases los cuales podemos clasificar en dos grandes grupos:

\begin{itemize} [noitemsep,nolistsep]
	\item Compases regulares.
	\item Compases irregulares.
\end{itemize}

Los compases regulares están regidos por formas regulares las cuales dictan el tiempo, mientras que en los compases irregulares hay que determinar la base de tiempo de forma indirecta.

Cada nota puede tener un valor de tiempo y este valor estará determinado por el compás que se esté utilizando, por ejemplo en un compás de 4/4 las figuras musicales tendrán los siguientes valores:

\begin{table}[H]
	\begin{center}
		\begin{tabular}{|l|l|l|l|}
			\hline
			Nombre & Figura & Silencio & Valor/Pulsos\\
			\hline \hline \hline \hline
			Redonda      & \Ganz & \GaPa & 4 Tiempos \\ \hline
			Blanca       & \Halb & \HaPa & 2 Tiempos \\ \hline
			Negra        & \Vier & \ViPa & 1 Tiempo \\ \hline
			Corchea      & \Acht & \AcPa & $1/2$ Tiempo \\ \hline
			Semicorchea  & \Sech & \SePa & $1/4$ Tiempo \\ \hline
			Fusa         & \Zwdr & \ZwPa & $1/8$ Tiempo \\ \hline
		\end{tabular}
		\caption{Duración de notas musicales.}
		\label{tabla:notes_val}
	\end{center}
\end{table}

Como se puede observar para cada figura musical existe su silencio correspondiente, el cual tendrá el mismo valor solo que este caso no se producirá sonido alguno.

Podemos tener también los valores relativos de estas notas respecto a otras notas:

\begin{table}[H]
	\begin{center}
		\begin{tabular}{|l|l|l|l|l|l|l|l|}
			\hline
			 &  & \Ganz & \Halb & \Vier & \Acht & \Sech & \Zwdr\\
			\hline \hline \hline \hline \hline
			Redonda      & \Ganz & 1      & 2      & 4     & 8     & 16    & 32 \\ \hline
			Blanca       & \Halb & $1/2$  & 1      & 2     & 4     & 8     & 16 \\ \hline
			Negra        & \Vier & $1/4$  & $1/2$  & 1     & 2     & 4     & 8 \\ \hline
			Corchea      & \Acht & $1/8$  & $1/4$  & $1/2$ & 1     & 2     & 4 \\ \hline
			Semicorchea  & \Sech & $1/16$ & $1/8$  & $1/4$ & $1/2$ & 1     & 2 \\ \hline
			Fusa         & \Zwdr & $1/32$ & $1/16$ & $1/8$ & $1/4$ & $1/2$ & 1 \\ \hline
		\end{tabular}
		\caption{Valor relativo de las notas.}
		\label{tabla:valor_rel}
	\end{center}
\end{table}

De tal manera que en un compás tendremos dos datos los cuales se describen a continuación:

\begin{figure}[H]
	\centerline{\includegraphics[width=4cm]{compas.png}}
	\caption{Compas}
	\label{fig:compas}
\end{figure}

Se puede ver que este compas tendrá 2 pulsos y el valor de cada pulso será de un tiempo de negra, ya que el valor relativo de la negra respecto a la redonda es de $1/4$.

Otro punto a considerar en los compases es que estos tienen tiempos fuertes, semifuertes y débiles. La cuadratura de una armonía usa estos tiempos para indicar los cambios que se deben de hacer.

Este es un ejemplo de los tiempos en compases de $4/4$, $3/4$ y $2/4$: 

\begin{figure}[H]
	\centerline{\includegraphics[width=12cm]{tiempos_fd.png}}
	\caption{Tiempos fuertes y débiles}
	\label{fig:tiempos_fd}
\end{figure}

\subsection{Escalas}

Las escalas son una serie de notas musicales que siguen un orden establecido por intervalos desde una nota base. En el mundo de la música hay una infinidad de escalas pero todas parten de la escala mayor de Do:

\begin{figure}[H]
	\centerline{\includegraphics[width=8cm]{escala.png}}
	\caption{Escala de Do Mayor}
	\label{fig:escala}
\end{figure}

En la escala mayor se tiene los siguientes intervalos: tono, tono, semitono, tono, tono, tono, semitono, si esta fórmula la aplicamos con las otras notas musicales podremos construir todas las escalas mayores.

Por ejemplo la escala de sol mayor quedaría de la siguiente manera:

\begin{figure}[H]
	\centerline{\includegraphics[width=8cm]{escala_sol.png}}
	\caption{Escala de Sol Mayor}
	\label{fig:escala_sol}
\end{figure}

Para poder completar el tono completo de la fórmula de la escala mayor entre Mi y Fa se tuvo que poner una alteración en la nota de Fa.

La única escala mayor que no posee alteraciones es la escala mayor de Do, de ahí en más todas las demás escalas mayores tendrán al menos una alteración.

Las escalas menores parten de la escala mayor obteniendo su sexta nota y siguiendo las mismas notas de la escala mayor. Estas escalas menores se les conocen como menores relativas, ya que se basan en una escala mayor para su formación.

Por ejemplo la escala relativa de Do mayor seria La menor y esta escala posee exactamente las mismas notas que la escala mayor solamente que empieza desde la nota de La:

En este caso las notas son: La, Si, Do, Re, Mi, Fa, Sol, La.

\begin{figure}[H]
	\centerline{\includegraphics[width=8cm]{escala_la_men.png}}
	\caption{Escala de La menor}
	\label{fig:escala_la_men}
\end{figure}

Esta relatividad puede ser usada con todas las escalas mayores para obtener sus relativas menores.

A pesar que las escalas mayores y menores poseen las mismas notas no deben ser nunca confundidas ya que el sonido final producido es muy diferente, mientras las escalas mayores se usan para canciones se puede decir hasta cierto punto alegres, las escalas menores normalmente acompañan melodías melancólicas, esto no es en todos los casos.

\subsection{Armaduras}

Todas las alteraciones de una escala se pueden juntar al inicio del pentagrama para dar lugar a lo que se conoce como armaduras.

Estas armaduras indicaran que todas las notas que poseen alteraciones las mantendrán a lo largo de toda la canción.

Debido a que las escalas mayores y sus relativas menores poseen las mismas alteraciones comparten también la misma armadura:

\begin{figure}[H]
	\centerline{\includegraphics[width=10cm]{armaduras.png}}
	\caption{Armaduras}
	\label{fig:armadura}
\end{figure}

\subsection{Tonalidades}

La tonalidad de una canción se basa en la escala base de la canción y esta la podemos averiguar viendo la armadura que posee la canción, aunque como se vio anteriormente las escalas mayores y sus relativas poseen la misma armadura, así que antes de definir la tonalidad en base a la armadura también se debe de hacer un análisis de la interacción de las notas en la canción.

Dentro de las tonalidades tenemos tonalidades mayores y menores, por ejemplo si vemos un pentagrama el cual no posee alteraciones podríamos asumir que la canción esta en Do mayor o en La menor, el siguiente paso sería ver la interacción de las notas en la canción para determinar correctamente la tonalidad.

\subsection{Melodías y Armonías}

Una melodía es una sucesión de notas de forma ascendente o descendente que llevan cierta cordura. 

Las melodías suelen estar formadas por frases y generalmente se repiten a lo largo de una canción variando algunas notas intermedias. En este caso se trata de una sucesión de notas que no son tocadas al mismo tiempo sino que una nota es tocada después de la otra.

Las armonías son una conjunción de sonidos tocados al mismo tiempo, normalmente la sucesión de varios acordes armónicos está ligado directamente con la melodía de la canción.

La armonía ha cambiado considerablemente desde la época de la música barroca hasta la música moderna, anteriormente para generar sistemas armónicos se usaban varios instrumentos tocando una nota en específico y la conjunción de todos los sonidos daba como resultado la armonía, actualmente la armonía es creada a partir de acordes de instrumentos que puedan generar este tipo de condiciones.

Esta es una comparativa para diferenciar entre lo que sería una melodía y una armonía:

\begin{figure}[H]
	\centerline{\includegraphics[width=8cm]{melo_armo.png}}
	\caption{Melodía y Armonía}
	\label{fig:melo_armo}
\end{figure}

\newpage

\section{Formato MIDI}

MIDI (Interfaz digital de instrumentos musicales) es un estándar técnico que describe un protocolo, una interfaz digital y conectores para la interoperabilidad entre varios instrumentos musicales electrónicos, software y dispositivos. \cite{Lear_Coli}

Los archivos MIDI transmiten datos, no sonidos, y estos datos son almacenados en Tracks. Cada archivo MIDI puede tener 1 o mas Tracks.

Los Tracks poseen mensajes de eventos que especifican información de notas (como tono y velocidad), así como señales de control para parámetros (como volumen, vibrato y señales de reloj). Tambien hay eventos que dan informacion acerca del instrumento, clave musical y tiempo. En la figura \ref{fig:formato_midi} se observa la estructura de un archivo MIDI.

\begin{figure}[H]
	\centerline{\includegraphics[width=12cm]{formato_midi.png}}
	\caption{Formato MIDI}
	\label{fig:formato_midi}
\end{figure}

Los mensajes MIDI estan estructurados en octetos, por lo que solo pueden existir $2^{3}$ tipos de mensajes diferentes. Cuando se transmiten, a cada octeto se le agrega el bit de paridad con la finalidad de detectar errores en la transmición o recepción.

En la tabla \ref{tabla:mensajes_midi} se muestran los diferentes eventos que existen y sus parametros:

\begin{table}[H]
	\begin{center}
		\begin{tabular}{|l|l|l|l|}
			\hline
			Mensaje & Código & Parametro 1 & Parametro 2\\
			\hline \hline \hline \hline
			Note Off               & 0x8 & Numero de nota        & Velocidad \\ \hline
			Note On                & 0x9 & Numero de nota        & Velocidad \\ \hline
			Polyphonic aftertouch  & 0xA & Numero de nota        & Presión \\ \hline
			Control Change         & 0xB & Numero de controlador & Datos \\ \hline
			Program Change         & 0xC & Numero de programa    & - \\ \hline
			Channel aftertouch     & 0xD & Presion               & - \\ \hline
			Pitch wheel            & 0xE & LSByte                & MSByte \\ \hline
			System Message         & 0xF & -                     & - \\ \hline
		\end{tabular}
		\caption{Mensajes MIDI.}
		\label{tabla:mensajes_midi}
	\end{center}
\end{table}

Cada uno de los mensajes se describen a continuación \cite{Lear_Coli}\cite{sergi_audio}:

\begin{itemize}
	\item \textbf{Note on.-} Este mensaje le indica al dispositivo, que debe iniciar una nota. Indica que una nota debe ser reproducida. Contiene la información de estado (número de canal, especificado por un entero dentro de [0 15] y dos valores de datos: un número de nota MIDI (el tono de la nota, un entero dentro de [0 127]) y una velocidad (que indica cómo la nota es reproducida, un entero dentro de [0 127]). Un ejemplo es ''Note on, 0, 60, 50'' que interpreta como: en el canal 1, comienza a reproducir un C medio con una velocidad de 50.
	\item \textbf{Note off.-} Indica que una nota termina. En esa situación, la velocidad indica qué tan rápido se libera la nota. Un ejemplo es ''Note off, 0, 60, 20'' que interpreta como: en el canal 1, deja de reproducir un C medio con una velocidad de 20. 
	\item \textbf{Polyphonic aftertouch.-} Algunos teclados de alta gama son capaces de detectar de forma permanente (decenas de veces por segundo) los cambios en la presión ejercida sobre cada una de sus teclas. En este	caso, siempre que se produzca algún cambio, envían este mensaje.
	\item \textbf{Control Change.-} Este mensaje engloba 128 posibles mensajes de	control diferentes Todos ellos afectan de alguna forma a la calidad del sonido; existen controles para modificar el volumen, la modulación, la reverberación, etc. 
	\item \textbf{Program Change.-} Evento para designar los diferentes sonidos disponibles en un sintetizador (instrumentos, efectos sonoros, etc.). 
	\item \textbf{Channel aftertouch.-} Este mensaje es parecido al Polyphonic aftertouch con la diferencia de que en lugar de enviar un mensaje de presión por cada nota, se envia uno por cada canal.
	\item \textbf{Pitch wheel.-} la inmensa mayoría de teclados disponen a la izquierda, de
	dos pequeñas ruedas giratorias. Una de ellas (la que vuelve automáticamente a su posición
	central), se utiliza para desafinar ligeramente el sonido. Cuando la rueda gira, el teclado envía
	estos mensajes de forma ?continua? (decenas de veces por segundo).
	\item \textbf{System Message.-} Estos mensajes se comportan de forma diferente a todos los anteriores, ya que los cuatro bits restantes no indican un número de canal, y por ello, afectan globalmente al comportamiento de los dispositivos que los reciban. Estos cuatro bits restantes, definen de hecho dieciséis mensajes diferentes, que se reparten en tres grupos: los mensajes comunes de sistema, los 	mensajes de sistema de tiempo real y los mensajes de sistema exclusivo. 
\end{itemize}

En la siguiente tabla \ref{tabla:n_notas_midi} se puede observar los valores de las notas y a que octava pertenecen:

\begin{table}[H]
	\begin{center}
		\begin{tabular}{|l|l|l|l|l|l|l|l|l|l|l|l|l|}
			\hline
			Octava & C & C\# & D & D\# & E & F & F\# & G & G\# & A & A\# & B \\
			\hline \hline \hline \hline \hline \hline \hline \hline \hline \hline \hline \hline \hline
			-1 & 0   & 1   & 2   & 3   & 4   & 5   & 6   & 7   & 8   & 9   & 10  & 11  \\ \hline
			0  & 12  & 13  & 14  & 15  & 16  & 17  & 18  & 19  & 20  & 21  & 22  & 23  \\ \hline
			1  & 24  & 25  & 26  & 27  & 28  & 29  & 30  & 31  & 32  & 33  & 34  & 35  \\ \hline
			2  & 36  & 37  & 38  & 39  & 40  & 41  & 42  & 43  & 44  & 45  & 46  & 47  \\ \hline
			3  & 48  & 49  & 50  & 51  & 52  & 53  & 54  & 55  & 56  & 57  & 58  & 59  \\ \hline
			4  & 60  & 61  & 62  & 63  & 64  & 65  & 66  & 67  & 68  & 69  & 70  & 71  \\ \hline
			5  & 72  & 73  & 74  & 75  & 76  & 77  & 78  & 79  & 80  & 81  & 82  & 83  \\ \hline
			6  & 84  & 85  & 86  & 87  & 88  & 89  & 90  & 91  & 92  & 93  & 94  & 95  \\ \hline
			7  & 96  & 97  & 98  & 99  & 100 & 101 & 102 & 103 & 104 & 105 & 106 & 107 \\ \hline
			8  & 108 & 109 & 110 & 111 & 112 & 113 & 114 & 115 & 116 & 117 & 118 & 119 \\ \hline
			9  & 120 & 121 & 122 & 123 & 124 & 125 & 126 & 127 &     &     &     &     \\ \hline
		\end{tabular}
		\caption{Numero de nota en formato MIDI.}
		\label{tabla:n_notas_midi}
	\end{center}
\end{table}

Cada evento de nota está realmente incrustado en un fragmento de pista, una estructura de datos que contiene un valor de tiempo delta que especifica la información de temporización y el evento en sí. Un valor de tiempo delta representa la posición de tiempo, como un valor absoluto, del evento y podría representar:

\begin{itemize}
	\item \textbf{Metrical time.-} Representa el numero de pulsos desde el comienzo. Una referencia llamada división y es definida en el encabezado del archivo, especificando cuantos pulsos por nota de cuarto.
	\item \textbf{time-code-based time.-} Representa el tiempo relacionado con horas, minutos y segundos de la canción. 
\end{itemize}

Un ejemplo de un extracto de un archivo MIDI y su partitura correspondiente es mostrado en las siguientes figuras \ref{fig:extract_midi} \ref{fig:repres_midi}.

\begin{figure}[H]
	\centerline{\includegraphics[width=12cm]{eventos_midi.png}}
	\caption{Extracto de un formato MIDI}
	\label{fig:extract_midi}
\end{figure}

\begin{figure}[H]
	\centerline{\includegraphics[width=6cm]{repres_midi.png}}
	\caption{Partitura correspondiente al extracto MIDI}
	\label{fig:repres_midi}
\end{figure}

Dentro del formato MIDI se pueden representar en cada track un instrumento diferente, para realizar esto se utiliza el evento "Program Change", el cual dependiendo de su valor, sera el instrumento a reproducir.

\begin{table}[H]
	\begin{center}
		\resizebox{\textwidth}{!}{%
		\begin{tabular}{|l|l|l|l|l|l|l|l|}
			\hline
			PC & Instrumento & PC & Instrumento & PC & Instrumento & PC & Instrumento\\
			\hline \hline \hline \hline \hline \hline \hline \hline
			1    &    Acoustic Grand Piano   &   9    &    Celesta            &   17   &    Drawbar Organ         &   25   &    Acoustic Guitar (nylon) \\ \hline
			2    &    Bright Acoustic Piano  &   10   &    Glockenspiel       &   18   &    Percussive Organ      &   26   &    Acoustic Guitar (steel) \\ \hline
			3    &    Electric Grand Piano   &   11   &    Music Box          &   19   &    Rock Organ            &   27   &    Electric Guitar (jazz) \\ \hline
			4    &    Honky-tonk Piano       &   12   &    Vibraphone         &   20   &    Church Organ          &   28   &    Electric Guitar (clean) \\ \hline
			5    &    Electric Piano 1       &   13   &    Marimba            &   21   &    Reed Organ            &   29   &    Electric Guitar (muted) \\ \hline
			6    &    Electric Piano 2       &   14   &    Xylophone          &   22   &    Accordion             &   30   &    Overdriven Guitar \\ \hline
			7    &    Harpsichord            &   15   &    Tubular Bells      &   23   &    Harmonica             &   31   &    Distortion Guitar \\ \hline
			8    &    Clavi                  &   16   &    Dulcimer           &   24   &    Tango Accordion       &   32   &    Guitar harmonics \\ \hline
			\hline \hline \hline \hline \hline \hline \hline \hline
			33   &    Acoustic Bass          &   41   &    Violin             &   49   &    String Ensemble 1     &   57   &    Trumpet \\ \hline
			34   &    Electric Bass (finger) &   42   &    Viola              &   50   &    String Ensemble 2     &   58   &    Trombone \\ \hline
			35   &    Electric Bass (pick)   &   43   &    Cello              &   51   &    SynthStrings 1        &   59   &    Tuba \\ \hline
			36   &    Fretless Bass          &   44   &    Contrabass         &   52   &    SynthStrings 2        &   60   &    Muted Trumpet \\ \hline
			37   &    Slap Bass 1            &   45   &    Tremolo Strings    &   53   &    Choir Aahs            &   61   &    French Horn \\ \hline
			38   &    Slap Bass 2            &   46   &    Pizzicato Strings  &   54   &    Voice Oohs            &   62   &    Brass Section \\ \hline
			39   &    Synth Bass 1           &   47   &    Orchestral Harp    &   55   &    Synth Voice           &   63   &    SynthBrass 1 \\ \hline
			40   &    Synth Bass 2           &   48   &    Timpani            &   56   &    Orchestra Hit         &   64   &    SynthBrass 2 \\ \hline
			\hline \hline \hline \hline \hline \hline \hline \hline
			65   &    Soprano Sax            &   73   &    Piccolo            &   81   &    Lead 1 (square)       &   89   &    Pad 1 (new age) \\ \hline
			66   &    Alto Sax               &   74   &    Flute              &   82   &    Lead 2 (sawtooth)     &   90   &    Pad 2 (warm) \\ \hline
			67   &    Tenor Sax              &   75   &    Recorder           &   83   &    Lead 3 (calliope)     &   91   &    Pad 3 (polysynth) \\ \hline
			68   &    Baritone Sax           &   76   &    Pan Flute          &   84   &    Lead 4 (chiff)        &   92   &    Pad 4 (choir) \\ \hline
			69   &    Oboe                   &   77   &    Blown Bottle       &   85   &    Lead 5 (charang)      &   93   &    Pad 5 (bowed) \\ \hline
			70   &    English Horn           &   78   &    Shakuhachi         &   86   &    Lead 6 (voice)        &   94   &    Pad 6 (metallic) \\ \hline
			71   &    Bassoon                &   79   &    Whistle            &   87   &    Lead 7 (fifths)       &   95   &    Pad 7 (halo) \\ \hline
			72   &    Clarinet               &   80   &    Ocarina            &   88   &    Lead 8 (bass + lead)  &   96   &    Pad 8 (sweep) \\ \hline
			\hline \hline \hline \hline \hline \hline \hline \hline
			97   &    FX 1 (rain)            &   105  &    Sitar              &   113  &    Tinkle Bell           &   121  &    Guitar Fret Noise \\ \hline
			98   &    FX 2 (soundtrack)      &   106  &    Banjo              &   114  &    Agogo                 &   122  &    Breath Noise \\ \hline
			99   &    FX 3 (crystal)         &   107  &    Shamisen           &   115  &    Steel Drums           &   123  &    Seashore \\ \hline
			100  &    FX 4 (atmosphere)      &   108  &    Koto               &   116  &    Woodblock             &   124  &    Bird Tweet \\ \hline
			101  &    FX 5 (brightness)      &   109  &    Kalimba            &   117  &    Taiko Drum            &   125  &    Telephone Ring \\ \hline
			102  &    FX 6 (goblins)         &   110  &    Bag pipe           &   118  &    Melodic Tom           &   126  &    Helicopter \\ \hline
			103  &    FX 7 (echoes)          &   111  &    Fiddle             &   119  &    Synth Drum            &   127  &    Applause \\ \hline
			104  &    FX 8 (sci-fi)          &   112  &    Shanai             &   120  &    Reverse Cymbal        &   128  &    Gunshot \\ \hline
		\end{tabular}}
		\caption{Instrumentos en formato MIDI.}
		\label{tabla:instr_midi}
	\end{center}
\end{table} 

Los instrumentos de percusión no usan este evento, en lugar de eso usan el canal 10 para transmitir los datos.

\newpage

\section{Algoritmo Krumhansl-Schmuckler}

Este algoritmo es usado para determinar o asignar la tonalidad mas apropiada a una serie de notas musicales. Fue diseñado y desarrollado por Carol L. Krumhansl y Mark A. Schmuckler.

Para determinar cual es la tonalidad mas apropiada, el algoritmo hace uso del coeficiente de correlacion de Pearson:

\begin{equation}
R = \frac{\displaystyle\sum_{i=1}^{n}(x_i - \bar{x})(y_i - \bar{y})}{\sqrt{\displaystyle\sum_{i=1}^{n}(x_i - \bar{x})^{2}\displaystyle\sum_{i=1}^{n}(y_i - \bar{y})^{2}}}
\label{ec:coeficiente}
\end{equation}

El cual dado un conjunto de datos $(x, y)$ determina un valor entre $[-1, 1]$ el cual indica si el conjunto de datos $x$ tiene relacion con el conjunto de datos $y$:

\begin{itemize}
	\item \textbf{0 : } Indica que no hay relación lineal entre $x$ y $y$
	\item \textbf{1 : } Indica que hay una correlación perfecta positiva, si $x$ crece $y$ también.
	\item \textbf{-1 : } Indica que hay una correlación perfecta negativa, si $x$ crece $y$ decrece.
\end{itemize}

En el algoritmo para encontrar la tonalidad, una de las cordenadas representa un perfil de una tonalidad mayor (tabla \ref{tabla:per_ton_may}) o una tonalidad menor (tabla \ref{tabla:per_ton_men}). 

\begin{table}[H]
	\begin{center}
		\begin{tabular}{|l|l|l|l|l|l|l|l|l|l|l|l|}
			\hline
			Do & Do\# & Re & Re\# & Mi & Fa & Fa\# & Sol & Sol\# & La & La\# & Si \\ \hline
			6.35 & 2.23  & 3.48  & 2.33 & 4.38 & 4.09 & 2.52 & 5.19 & 2.39 & 3.66 & 2.29 & 2.88  \\ \hline
		\end{tabular}
		\caption{Perfil de tonalidades mayores.}
		\label{tabla:per_ton_may}
	\end{center}
\end{table}

\begin{table}[H]
	\begin{center}
		\begin{tabular}{|l|l|l|l|l|l|l|l|l|l|l|l|}
			\hline
			la & la\# & si & do & do\# & re & re\# & mi & fa & fa\# & sol & sol\# \\ \hline
			6.33 & 2.68 & 3.52  & 5.38 & 2.60 & 3.53 & 2.54 & 4.75 & 3.98 & 2.69 & 3.34 & 3.17  \\ \hline
		\end{tabular}
		\caption{Perfil de tonalidades menores.}
		\label{tabla:per_ton_men}
	\end{center}
\end{table}

El otro valor de las coordenadas es el total de duración de cada nota en la pieza musical siendo analizada. En la tabla \ref{tabla:dur_ejemplo} se observa un ejemplo de los valores de una canción:

\begin{table}[H]
	\begin{center}
		\begin{tabular}{|l|l|l|l|l|l|l|l|l|l|l|l|}
			\hline
			C & C\# & D & D\# & E & F & F\# & G & G\# & A & A\# & B \\ \hline
			432 & 231  & 0  & 405 & 12 & 316 & 4 & 126 & 612 & 0 & 191 & 1  \\ \hline
		\end{tabular}
		\caption{Ejemplo de duración de notas en una canción.}
		\label{tabla:dur_ejemplo}
	\end{center}
\end{table}

El algoritmo calcula el coeficiente de correlación para todas las posibles tonalidades mayores y menores. En las tablas \ref{tabla:cor_do_may} y \ref{tabla:cor_re_may} se muestra un ejemplo de como se empiezan a relacionar los datos de la cancion con los perfiles de las tonalidades:

\begin{table}[H]
	\begin{center}
		\begin{tabular}{|l|l|}
			\hline
			(Do, C)      &  (6.35, 432)  \\ \hline
			(Do\#, C\#)  &  (2.23, 231)  \\ \hline
			(Re, D)      &  (3.48, 0)  \\ \hline
			(Re\#, D\#)  &  (2.33, 405)  \\ \hline
			(Mi, E)      &  (4.38, 12)  \\ \hline
			(Fa, F)      &  (4.09, 316)  \\ \hline
			(Fa\#, F\#)  &  (2.52, 4)  \\ \hline
			(Sol, G)     &  (5.19, 126)  \\ \hline
			(Sol\#, G\#) &  (2.39, 612)  \\ \hline
			(La, A)      &  (3.66, 0)  \\ \hline
			(La\#, A\#)  &  (2.29, 191)  \\ \hline
			(Si, B)      &  (2.88, 1)  \\ \hline
		\end{tabular}
		\caption{Correlación de Do Mayor.}
		\label{tabla:cor_do_may}
	\end{center}
\end{table} 

En el caso de la tonalidad de Do Mayor obtenemos un coeficiente de correlación de $R=0.00009$, lo que significa que no hay probabilidad de que esta sea la tonalidad adecuada para la canción.

Si se grafican los puntos de las coordenadas $(x, y)$ para esta tonalidad se vera que los puntos estan demasiados dispersos entre si, por lo tanto no podemos encontrar una linea recta que prediga la posición de nuevos puntos.

Ahora vamos a analizar que pasa con la tonalidad de Re Mayor.

\begin{table}[H]
	\begin{center}
		\begin{tabular}{|l|l|}
			\hline
			(Do, D)      &  (6.35, 0)  \\ \hline
			(Do\#, D\#)  &  (2.23, 405)  \\ \hline
			(Re, E)      &  (3.48, 12)  \\ \hline
			(Re\#, F)    &  (2.33, 316)  \\ \hline
			(Mi, F\#)    &  (4.38, 4)  \\ \hline
			(Fa, G)      &  (4.09, 126)  \\ \hline
			(Fa\#, G\#)  &  (2.52, 612)  \\ \hline
			(Sol, A)     &  (5.19, 0)  \\ \hline
			(Sol\#, A\#) &  (2.39, 191)  \\ \hline
			(La, B)      &  (3.66, 1)  \\ \hline
			(La\#, C)    &  (2.29, 432)  \\ \hline
			(Si, C\#)    &  (2.88, 231)  \\ \hline
		\end{tabular}
		\caption{Correlación de Re Mayor.}
		\label{tabla:cor_re_may}
	\end{center}
\end{table} 

En este caso los puntos no se encuentran tan dispersos, por lo que obtenemos un coeficiente de correlación de $R=-0.74$, lo que significa que existe una gran correlación negativa.

Si se realiza este mismo ejercicio con todas las posibles tonalidades obtendremos que la tonalidad que obtuvo mayor correlación es Sol\# Mayor con un coeficiente de $R=0.97$, por lo tanto esta seria la tonalidad mas adecuada de la pieza.

Este algoritmo regresa una lista ordenada de todos los valores posibles y su coeficiente de correlación, donde el primer elemento es el que mayor correlación contiene, y así sucesivamente para los siguientes elementos